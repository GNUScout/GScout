{% extends 'socios/form_base.html' %}
{% block navbar-content %}	
	<li><a href="/">Home</a></li>
	<li><a href="/socios/new">Nuevo Socio</a></li>
	<li class="active dropdown">
		<a href='#' class="dropdown-toggle" data-toggle="dropdown">
			Listados
			<b class="caret"></b>
		</a>
		<ul class="dropdown-menu">
			<li>
				<a href="/socios/listado">Listado Socios</a>
			</li>
			<li>
				<a href="/socios/listado_economicos">Listado Economico</a>
			</li>	
		</ul>
	</li>
	<li><a href="/socios/listado_del">Borrar Socios</a></li>
	<li><a href="/socios/search_familia">Editar Familias</a></li>	  
	<li><a href="/socios/search">Buscar ID</a></li>
{% endblock %}

{% block form-head %}
<script src="/static/js/jquery-1.9.1.js" type='text/javascript'></script>
</script>
<script LANGUAGE="JavaScript">

	var tabla = 0;
	
	var medicamentos = 0;
	
	var nombre = new Array();
	var dosis = new Array();
	var pauta = new Array();
	
	
	function clickNo() {
		$("#boton_add").hide();
		$("#boton_del").hide();
		medicamentos = 0;
		tabla=0;
		$("#todo").remove();
		item= "<div id='todo'><div id ='content'></div></div>"
		$("#boton_add").before(item)
	};
	function total_medicamentos(tableID) {
        var table = document.getElementById(tableID);
        medicamentos = table.rows.length;
		item= "<input id='total_medicamentos' type='hidden' name='total_medicamentos' value='"+medicamentos+"'>"
		$("#boton_add").before(item)
	};
	
	function addTable() {
		
		if (tabla == 0){
			//medicamentos = medicamentos + 1;
			tabla = 1;
			$("#boton_add").show();
			$("#boton_del").show();
			item=	"<TABLE id='dataTable' width='350px'>" +
						        "<TR>"+
						        	"<TD><INPUT type='checkbox' name='chk'/></TD>"+
						            "<td><input id='inputMedicamento"+medicamentos+"' type='text' name='m[]' placeholder='¿Cual?'></td>"+
									"<td><input type='text' name='md[]' placeholder='Dosis'></td>"+
									"<td><input type='text' name='mp[]' placeholder='Pauta'></td>"+
						        "</TR>"+
						    "</TABLE>";
			$("#content").before(item)
		}
	};	
	function addRow(tableID) {
 			
			$("#boton_add").show();
			$("#boton_del").show();
            var table = document.getElementById(tableID);
 
            medicamentos = table.rows.length;
            
            var row = table.insertRow(medicamentos);
 
            var colCount = table.rows[0].cells.length;
 
            for(var i=0; i<colCount; i++) {
 
                var newcell = row.insertCell(i);
 
                newcell.innerHTML = table.rows[0].cells[i].innerHTML;
                //alert(newcell.childNodes);
                switch(newcell.childNodes[0].type) {
                    case "text":
                            newcell.childNodes[0].value = "";
                            break;
                    case "checkbox":
                            newcell.childNodes[0].checked = false;
                            break;
                    case "select-one":
                            newcell.childNodes[0].selectedIndex = 0;
                            break;
                }
            }
       };
       
    function deleteRow(tableID) {
            try {
            var table = document.getElementById(tableID);
            medicamentos = table.rows.length;
 
            for(var i=0; i<medicamentos; i++) {
                var row = table.rows[i];
                var chkbox = row.cells[0].childNodes[0];
                if(null != chkbox && true == chkbox.checked) {
                    if(medicamentos <= 1) {
                        alert("Cannot delete all the rows.");
                        break;
                    }
                    table.deleteRow(i);
                    medicamentos--;
                    i--;
                    if (medicamentos == 0) {
						$("#boton_del").hide();
						$("#boton_add").hide();
						tabla=0;
						$("#todo").remove();
						item= "<div id='todo'><div id ='content'></div></div>"
						$("#boton_add").before(item)
					}
                }
 
 
            }
            }catch(e) {
                alert(e);
            }
        };
	


</script>
{% endblock %}
{% block form-title %}<h2 >Datos Médicos del socio nº {{medicos.socio_id.n_asociado}}</h2>{% endblock %}
{% block form %}
				<form method="post" class="form-horizontal" action="/socios/modify_medicos/">
					{% csrf_token %}
					<input type="hidden" name="socio" value="{{medicos.socio_id.n_asociado}}">
					<input type="hidden" id="n_medicamentos" name="n_medicamentos" value="{{n_medicamentos}}">
					

					<div class="control-group">
						<label class="control-label" for="inputSeguro">Tipo de seguro</label>
						<div class="controls">
							<input type="hidden" name="ss" value="">
							<input type="hidden" name="smp" value="">
						  	<input id="inputSeguro1" type="checkbox" name="ss" value="Seguridad social">	Seguridad social
						  	<br><input id="inputSeguro2" type="checkbox" name="smp" value="Seguro medico Privado">	Seguro médico privado</br>
						  	<script language="JavaScript">
								var opcion = "{{medicos.ss}}";
								if (opcion == "Seguridad social")
									{
							    	$('input[name=ss]').attr('checked', true);
							    	}
							    var opcion2 = "{{medicos.smp}}";
								if (opcion2 == "Seguro medico Privado")
									{
							    	$('input[name=smp]').attr('checked', true);
							    	}
							</script>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputPoliza">Nº de Poliza</label>
						<div class="controls">
						  <input type="text" id="inputPoliza" name="n_poliza" placeholder="Nº de Poliza">
						</div>
					</div>
					<h4 align="center">Patologías específicas e intervenciones quirúrgicas</h4>
					<hr align="left" noshade="noshade" size="3" width="100%" />
					<div class="control-group">
						<label class="control-label">¿Padece o ha padecido alguna enfermedad?</label>
						<div class="controls">	
							<label class="radio">
								<input type="radio" name="enfermedad" id="optionsRadios1" value="no" checked>
								No
							</label>
							<label class="radio">
								<input type="radio" name="enfermedad" id="optionsRadios2" value="si">
								Si
							</label>
							<input id="enfermedad" type="hidden" value="{{medicos.enfermedad}}">
							<script language="JavaScript">
								var opcion = $("#enfermedad").val();
								if (opcion == "si")
									{
							    	$('input[id="optionsRadios2"]').attr('checked', true);
							    	}
							</script>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputEnfermedad">¿Cual?</label>
						<div class="controls">
						  <textarea id="inputEnfermedad" name="t_enfermedad"></textarea>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">¿Padece alguna enfermedad crónica, fisica o psíquica??</label>
						<div class="controls">
							<label class="radio">
								<input type="radio" name="enfermedad_cfp" id="optionsRadios1" value="no" checked>
								No
							</label>
							<label class="radio">
								<input type="radio" name="enfermedad_cfp" id="optionsRadios2" value="si">
								Si
							</label>
							<input id="enfermedad_cfp" type="hidden" value="{{medicos.enfermedad_cfp}}">
							<script language="JavaScript">
								var opcion = $("#enfermedad_cfp").val();
								if (opcion == "si")
									{
							    	$('input[id="optionsRadios2"]').attr('checked', true);
							    	}
							</script>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputCFP">¿Cual? ¿Y en que grado?</label>
						<div class="controls">
						  <textarea id="inputCFP" name="t_enfermedad_cfp"></textarea>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">¿Esta operado?</label>
						<div class="controls">
							<label class="radio">
								<input type="radio" name="operado" id="optionsRadios1" value="no" checked>
								No
							</label>
							<label class="radio">
								<input type="radio" name="operado" id="optionsRadios2" value="si">
								Si
							</label>
							<input id="operado" type="hidden" value="{{medicos.operado}}">
							<script language="JavaScript">
								var opcion = $("#operado").val();
								if (opcion == "si")
									{
							    	$('input[id="optionsRadios2"]').attr('checked', true);
							    	}
							</script>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputOperdado">¿De que?</label>
						<div class="controls">
						  <textarea id="inputOperado" name="t_operado"></textarea>
						</div>
					</div>
					<h4 align="center">Alergias y dietas específicas</h4>
					<hr align="left" noshade="noshade" size="3" width="100%" />
					<div class="control-group">
						<label class="control-label">¿Es alergico a algun tipo de medicamento?</label>
						<div class="controls">
							<label class="radio">
								<input type="radio" name="alergia" id="optionsRadios1" value="no" checked>
								No
							</label>
							<label class="radio">
								<input type="radio" name="alergia" id="optionsRadios2" value="si">
								Si
							</label>
							<input id="alergia" type="hidden" value="{{medicos.alergia}}">
							<script language="JavaScript">
								var opcion = $("#alergia").val();
								if (opcion == "si")
									{
							    	$('input[id="optionsRadios2"]').attr('checked', true);
							    	}
							</script>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputAlergia">¿Cual?</label>
						<div class="controls">
						  <textarea id="inputAlergia" name="t_alergia"></textarea>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">¿Presenta mas alergias?</label>
						<div class="controls">
							<label class="radio">
								<input type="radio" name="otras_alergias" id="optionsRadios1" value="no" checked>
								No
							</label>
							<label class="radio">
								<input type="radio" name="otras_alergias" id="optionsRadios2" value="si">
								Si
							</label>
							<input id="otras_alergias" type="hidden" value="{{medicos.otras_alergias}}">
							<script language="JavaScript">
								var opcion = $("#otras_alergias").val();
								if (opcion == "si")
									{
							    	$('input[id="optionsRadios2"]').attr('checked', true);
							    	}
							</script>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputOtrasAlergias">¿A que?</label>
						<div class="controls">
						  <textarea id="inputOtrasAlergias" name="t_otras_alergias"></textarea>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">¿Sigue algun regimen o dieta especial?</label>
						<div class="controls">
							<label class="radio">
								<input type="radio" name="dieta" id="optionsRadios1" value="no" checked>
								No
							</label>
							<label class="radio">
								<input type="radio" name="dieta" id="optionsRadios2" value="si">
								Si
							</label>
							<input id="dieta" type="hidden" value="{{medicos.dieta}}">
							<script language="JavaScript">
								var opcion = $("#dieta").val();
								if (opcion == "si")
									{
							    	$('input[id="optionsRadios2"]').attr('checked', true);
							    	}
							</script>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="inputDieta">¿Cual? Y motivos</label>
						<div class="controls">
						  <textarea id="inputDieta" name="t_dieta"></textarea>
						</div>
					</div>
					<h4 align="center">Medicación</h4>
					<hr align="left" noshade="noshade" size="3" width="100%" />
					<div class="control-group">
						<label class="control-label">¿Esta tomando actualmente algún medicamento?</label>
						<div class="controls">
							<label class="radio">
								<input type="radio" name="toma_medicamentos" id="medicamento1" onclick="clickNo()" value="no" checked>
								No
							</label>
							<label class="radio">
								<input type="radio" name="toma_medicamentos" id="medicamento2" onclick="addTable()" value="si">
								Si
							</label>
							<input id="toma_medicamentos" type="hidden" value="{{medicos.toma_medicamentos}}">
							<script language="JavaScript">
								var opcion = $("#toma_medicamentos").val();

								if (opcion == "si")
									{
							    	$('input[id="medicamento2"]').attr('checked', true);
							    	}
							</script>
							{% if medicos.toma_medicamentos == "si" %}
								{% for m in medicamentos %}
									<script language="JavaScript">
										++medicamentos;
										nombre[medicamentos-1] = "{{ m.nombre }}";
										dosis[medicamentos-1] = "{{ m.dosis }}";
										pauta[medicamentos-1] = "{{ m.pauta }}";
									</script>
								{% endfor %}	
								<script language="JavaScript">								
									$(document).ready(function() {
										$("#boton_add").show();
										$("#boton_del").show();
										var item = "<TABLE id='dataTable' width='350px'>"+
												        "<TR>"+
												        	"<TD><INPUT type='checkbox' name='chk'/></TD>"+
												            "<td><input id='inputMedicamento"+medicamentos+"' type='text' name='m[]' value='"+nombre[0]+"'></td>"+
															"<td><input type='text' name='md[]' value='"+dosis[0]+"'></td>"+
															"<td><input type='text' name='mp[]' value='"+pauta[0]+"'></td>"+
												        "</TR>"+
												    "</TABLE>";
										
										$("#content").before(item);
										
										
	   									for (var i=1;i<medicamentos;i++){
											var table = document.getElementById("dataTable");
										
											var table_length = table.rows.length;
											var row = table.insertRow(table_length);
											
											var colCount = table.rows[0].cells.length;
											
											for(var j=0; j<colCount; j++) {
											 	
												var newcell = row.insertCell(j);
												 
												newcell.innerHTML = table.rows[0].cells[j].innerHTML;
												//alert(newcell.childNodes);
												switch(newcell.childNodes[0].type) {
													case "text":
														if (j==1){
															newcell.childNodes[0].value = nombre[i];
														};
														if (j==2){
															newcell.childNodes[0].value = dosis[i];
														};
														if (j==3){
															newcell.childNodes[0].value = pauta[i];
														};
														break;
													case "checkbox":
														newcell.childNodes[0].checked = false;
														break;
													case "select-one":
														newcell.childNodes[0].selectedIndex = 0;
														break;
												}
											}
										};
										
									});
								</script>
							{% endif %}
							
							
						</div>
					</div>
					<div id="todo">
						<div id ="content"></div>
					</div>
					<INPUT id="boton_add" type="button" value="Add Row" style="display:none" onclick="addRow('dataTable')" />
					<INPUT id="boton_del" type="button" value="Delete Row" style="display:none" onclick="deleteRow('dataTable')" />
					<hr align="left" noshade="noshade" size="3" width="100%" />
					<div class="control-group">
						<label class="control-label" for="inputInfo">Otra información de interes</label>
						<div class="controls">
						  <textarea id="inputInfo" name="info_adicional"></textarea>
						</div>
					</div>
					<input type="hidden"  />
					<div class="control-group">
						<div class="controls">
						   <button type="submit" class="btn" onclick="total_medicamentos('dataTable')">Crear</button>
						</div>
					</div>
				</form>				
{% endblock %}