{% extends 'socios/form_base.html' %}
{% block navbar-content %}	
	<li><a href="/">Home</a></li>
	<li><a href="/socios/new">Nuevo Socio</a></li>
	<li class="dropdown">
		<a href='#' class="dropdown-toggle" data-toggle="dropdown">
			Listados
			<b class="caret"></b>
		</a>
		<ul class="dropdown-menu">
			<li>
				<a href="/socios/listado">Listado Socios</a>
			</li>
			<li>
				<a href="/socios/listado_economicos">Listado Economico</a>
			</li>	
		</ul>
	</li>
	<li><a href="/socios/listado_del">Borrar Socios</a></li>	
	<li class="active"><a href="/socios/search_familia">Editar Familias</a></li>  
	<li><a href="/socios/search">Buscar ID</a></li>
{% endblock %}
{% block form-head %}
<script src="/static/js/jquery-1.9.1.js" type='text/javascript'></script>
</script>
<script LANGUAGE="JavaScript">

	
	
	var familiares = 0
	
	var nombre = new Array();
	var apellidos = new Array();
	var nif = new Array();
	var rol = new Array();
	var telefono = new Array();
	var movil = new Array();
	var email = new Array();
		
	function addRow(tableID) {
 			
            var table = document.getElementById(tableID);
 
 			for(var j=0; j<3; j++){
	            var familiares = table.rows.length;
	            
	            var row = table.insertRow(familiares);
	            
	            var colCount = table.rows[j].cells.length;
	 
	            for(var i=0; i<colCount; i++) {
	 
	                var newcell = row.insertCell(i);
	 
	                newcell.innerHTML = table.rows[j].cells[i].innerHTML;
	                //alert(newcell.childNodes);
	                switch(newcell.childNodes[0].type) {
	                    case "text":
	                            newcell.childNodes[0].value = "";
	                            break;
	                    case "checkbox":
	                            newcell.childNodes[0].checked = false;
	                            break;
	                    case "select-one":
	                            newcell.childNodes[0].selectedIndex = 0;
	                            break;
	                }
	            }
	            
	       }
            
       };
       
    function deleteRow(tableID) {
            try {
            var table = document.getElementById(tableID);
            familiares = table.rows.length;
 			
            for(var i=1; i<familiares; i=i+3) {
                var row = table.rows[i];
                var chkbox = row.cells[3].childNodes[0];
                
                if(null != chkbox && true == chkbox.checked) {
                    if(familiares <= 3) {
                        alert("Cannot delete all the rows.");
                        break;
                    }
                    for(var h=0; h<3; h++){
                    	table.deleteRow(i-1);
                    }
                    
                    familiares= familiares -3;
                    i=i-3;
                    if (familiares == 0) {
						$("#boton_del").hide();
						$("#boton_add").hide();
						
						$("#todo").remove();
						item= "<div id='todo'><div id ='content'></div></div>"
						$("#boton_add").before(item)
					}
                }
 
 
            }
            }catch(e) {
                alert(e);
            }
        };
</script>

<script src="/static/js/jquery-1.9.1.js" type='text/javascript'></script>           
<script type="text/javascript" src="/static/js/jquery.tablesorter.js"></script>
<!--<link href="/static/css/style.css" rel="stylesheet" type="text/css" media="screen"> -->
  
<!-- jQuery -->
	<script src="/static/js/jquery-1.9.1.js" type='text/javascript'></script>  

	<!-- Demo stuff -->
	<link href="/static/css/bootstrap.css" rel="stylesheet">

	<!-- Tablesorter: required for bootstrap -->
	<link rel="stylesheet" href="/static/css/theme.bootstrap.css">
	<script src="/static/js/jquery.tablesorter.js"></script>
	<script src="/static/js/jquery.tablesorter.widgets.js"></script>

	<!-- Tablesorter: optional -->
	<link rel="stylesheet" href="/static/addons/pager/jquery.tablesorter.pager.css">
	<script src="/static/addons/pager/jquery.tablesorter.pager.js"></script>

	<script id="js">$(function() {

	$.extend($.tablesorter.themes.bootstrap, {
		// these classes are added to the table. To see other table classes available,
		// look here: http://twitter.github.com/bootstrap/base-css.html#tables
		table      : 'table table-bordered',
		header     : 'bootstrap-header', // give the header a gradient background
		footerRow  : '',
		footerCells: '',
		icons      : '', // add "icon-white" to make them white; this icon class is added to the <i> in the header
		sortNone   : 'bootstrap-icon-unsorted',
		sortAsc    : 'icon-chevron-up',
		sortDesc   : 'icon-chevron-down',
		active     : '', // applied when column is sorted
		hover      : '', // use custom css here - bootstrap class may not override it
		filterRow  : '', // filter row class
		even       : '', // odd row zebra striping
		odd        : ''  // even row zebra striping
	});

	// call the tablesorter plugin and apply the uitheme widget
	$("table").tablesorter({
		theme : "bootstrap", // this will 

		widthFixed: true,

		headerTemplate : '{content} {icon}', // new in v2.7. Needed to add the bootstrap icon!

		// widget code contained in the jquery.tablesorter.widgets.js file
		// use the zebra stripe widget if you plan on hiding any rows (filter widget)
		widgets : [ "uitheme", "filter", "zebra" ],

		widgetOptions : {
			// using the default zebra striping class name, so it actually isn't included in the theme variable above
			// this is ONLY needed for bootstrap theming if you are using the filter widget, because rows are hidden
			zebra : ["even", "odd"],

			// reset filters button
			filter_reset : ".reset",

			// set the uitheme widget to use the bootstrap theme class names
			// uitheme : "bootstrap"

		}
	})
	.tablesorterPager({

		// target the pager markup - see the HTML block below
		container: $(".pager"),

		// target the pager page select dropdown - choose a page
		cssGoto  : ".pagenum",

		// remove rows from the table to speed up the sort of large tables.
		// setting this to false, only hides the non-visible rows; needed if you plan to add/remove rows with the pager enabled.
		removeRows: false,

		// output string - default is '{page}/{totalPages}';
		// possible variables: {page}, {totalPages}, {filteredPages}, {startRow}, {endRow}, {filteredRows} and {totalRows}
		output: '{startRow} - {endRow} / {filteredRows} ({totalRows})'

	});

});</script>
{% endblock %}
{% block form-title %}<h2>Datos Familiares</h2>{% endblock %}
{% block form %}
				<form  method="post" class="form-horizontal" action="/socios/modify_familiares/">
					{% csrf_token %}
					<div class="control-group">
							<p><b>Nota:</b> El la primera persona que figure en la lista sera el identificador de la familia. </p>
							<input type="hidden" name="oldfamily" value="{{familia.nif}}">
							
							<div id="todo">
								<div id ="content"></div>
							</div>
							{% for f in familiares %}
									<script language="JavaScript">
										++familiares;
										nombre[familiares-1] = "{{ f.nombre }}";
										apellidos[familiares-1] = "{{ f.apellidos }}";
										nif[familiares-1] = "{{ f.nif }}";
										rol[familiares-1] = "{{ f.rol }}";
										telefono[familiares-1] = "{{ f.telefono }}";
										movil[familiares-1] = "{{ f.movil }}";
										email[familiares-1] = "{{ f.email }}";
										
									</script>
								{% endfor %}	
								<script language="JavaScript">								
									$(document).ready(function() {
										
										item=	"<TABLE id='dataTable' width='750px'>" +
												 			"<TR>"+
													            "<td><input id='inputFamiliar"+familiares+"' type='text' name='fn[]' value='"+nombre[0]+"' placeholder='Nombre'></td>"+
																"<td><input type='text' name='fa[]' value='"+apellidos[0]+"' placeholder='Apellidos'></td>"+
																"<td><input type='text' name='fd[]' value='"+nif[0]+"' placeholder='NIF'></td>"+
																"<td><input type='text' name='fr[]' value='"+rol[0]+"' placeholder='Rol'></td>"+
															"</TR>"+
															"<TR>"+
																"<td><input type='text' name='ft[]' value='"+telefono[0]+"' placeholder='Telefono'></td>"+	
																"<td><input type='text' name='fm[]' value='"+movil[0]+"' placeholder='Movil'></td>"+
																"<td><input type='text' name='fe[]' value='"+email[0]+"' placeholder='Email'></td>"+
																"<td><input type='checkbox' name='chk'> ¿Eliminar?</td>"+
															"</TR>"+ 
															"<TR>"+
																"<td><p> </p></td>"+
															"</TR>"+   
												"</TABLE>";
										
										$("#content").before(item);
										
										
	   									for (var i=1;i<familiares;i++){
											var table = document.getElementById("dataTable");
										
											var cell = 1;
											
											for(var h=0; h<3; h++){
												
												var table_length = table.rows.length;
												var row = table.insertRow(table_length);
												
												var colCount = table.rows[0].cells.length;
												
												
												
												for(var j=0; j<colCount; j++) {
												 	
													var newcell = row.insertCell(j);
													 
													newcell.innerHTML = table.rows[h].cells[j].innerHTML;
													//alert(newcell.childNodes);
													switch(newcell.childNodes[0].type) {
														case "text":
															if (j==0){
																if(cell==2){
																	newcell.childNodes[0].value = telefono[i]; 	
																}else{
																	newcell.childNodes[0].value = nombre[i];
																}
															};
															if (j==1){
																if(cell==2){
																	newcell.childNodes[0].value = movil[i]; 	
																}else{
																	newcell.childNodes[0].value = apellidos[i];
																}
															};
															if (j==2){
																if(cell==2){
																	newcell.childNodes[0].value = email[i]; 	
																}else{
																	newcell.childNodes[0].value = nif[i];
																}
															};
															if (j==3){
																newcell.childNodes[0].value = rol[i];
																cell=	2;
															};
															if (j==4){
																newcell.childNodes[0].value = telefono[i];
															};
															if (j==5){
																newcell.childNodes[0].value = movil[i];
															};
															if (j==6){
																newcell.childNodes[0].value = email[i];
															};
															break;
														case "checkbox":
															newcell.childNodes[0].checked = false;
															break;
														case "select-one":
															newcell.childNodes[0].selectedIndex = 0;
															break;
													}
												}
											}
										};
										
									});
								</script>
							<INPUT id="boton_add" type="button" value="Añadir" onclick="addRow('dataTable')" />
							<INPUT id="boton_del" type="button" value="Eliminar" onclick="deleteRow('dataTable')" />		
					</div>
					
		
					
				
					<input type="hidden" value="f5" name="form_id" />
					<button type="submit" class="btn btn-large btn-primary">Editar</button>
					
					
					<h3>Hijos</h3>
					<table class="table table-striped table-bordered" width=100%>

						<tr>	
							<th><strong>NIF </strong></th>
							<th><strong>Nombre </strong></th>
							<th><strong>Apellidos </strong></th>
							<th><strong>Seccion </strong></th>
						</tr>
						
						<tbody>
						{% for h in hermanos %}
							{% if h.socio_id != socio %}
								<tr>
									<td ALIGN=CENTER><p>{{h.dni}} </p></td>
									<td ALIGN=CENTER><p>{{h.nombre}} </p></td>
									<td ALIGN=CENTER><p>{{h.apellidos}} </p></td>
									<td ALIGN=CENTER><p>{{h.seccion}} </p></td>
								</tr>
							{% endif %}
						{% endfor %}
						</tbody>
					</table>
											
				</form>
{% endblock %}
