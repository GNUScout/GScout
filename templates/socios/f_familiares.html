{% extends 'socios/form_base.html' %}
{% block navbar-content %}	
	<li><a href="/">Home</a></li>
	<li class="active"><a href="/socios/new">Nuevo Socio</a></li>
	<li class="dropdown">
		<a href='#' class="dropdown-toggle" data-toggle="dropdown">
			Listados
			<b class="caret"></b>
		</a>
		<ul class="dropdown-menu">
			<li>
				<a href="/socios/listado">Listado Socios</a>
			</li>
			<li>
				<a href="/socios/listado_economicos">Listado Economico</a>
			</li>	
		</ul>
	</li>
	<li><a href="/socios/listado_del">Borrar Socios</a></li>
	<li><a href="/socios/search_familia">Editar Familias</a></li>	  
	<li><a href="/socios/search">Buscar ID</a></li>
{% endblock %}
{% block form-head %}
<script src="/static/js/jquery-1.9.1.js" type='text/javascript'></script>
</script>
<script LANGUAGE="JavaScript">

	var tabla = 0;
	
	var familiares=0;
	
	function clickNo() {
		$("#boton_add").hide();
		$("#boton_del").hide();
		$("#family_div").show();
		familiares = 0;
		tabla=0;
		$("#todo").remove();
		item= "<div id='todo'><div id ='content'></div></div>"
		$("#boton_add").before(item)
	};
	
	function addTable() {
		
		if (tabla == 0){
			
			tabla = 1;
			$("#boton_add").show();
			$("#boton_del").show();
			$("#family_div").hide();
			item=	"<TABLE id='dataTable' width='750px'>" +
						        "<TR>"+
						        	
						            "<td><input id='inputFamiliar"+familiares+"' type='text' name='fn[]' placeholder='Nombre'></td>"+
									"<td><input type='text' name='fa[]' placeholder='Apellidos'></td>"+
									"<td><input type='text' name='fd[]' placeholder='NIF'></td>"+
									"<td><input type='text' name='fr[]' placeholder='多Padre, Madre o Tutor?'></td>"+
								"</TR>"+
								"<TR>"+
									"<td><input type='text' name='ft[]' placeholder='Telefono'></td>"+	
									"<td><input type='text' name='fm[]' placeholder='Movil'></td>"+
									"<td><input type='text' name='fe[]' placeholder='Email'></td>"+
									"<td><input type='checkbox' name='chk'> 多Eliminar?</td>"+
								"</TR>"+ 
								"<TR>"+
									"<td><p> </p></td>"+
								"</TR>"+   
					"</TABLE>";
			$("#content").before(item)
		}
	};	
	function addRow(tableID) {
 			
			$("#boton_add").show();
			$("#boton_del").show();
            var table = document.getElementById(tableID);
 
 			for(var j=0; j<3; j++){
	            var familiares = table.rows.length;
	            
	            var row = table.insertRow(familiares);
	            
	            var colCount = table.rows[j].cells.length;
	 
	            for(var i=0; i<colCount; i++) {
	 
	                var newcell = row.insertCell(i);
	 
	                newcell.innerHTML = table.rows[j].cells[i].innerHTML;
	                //alert(newcell.childNodes);
	                switch(newcell.childNodes[0].type) {
	                    case "text":
	                            newcell.childNodes[0].value = "";
	                            break;
	                    case "checkbox":
	                            newcell.childNodes[0].checked = false;
	                            break;
	                    case "select-one":
	                            newcell.childNodes[0].selectedIndex = 0;
	                            break;
	                }
	            }
	            
	       }
            
       };
       
    function deleteRow(tableID) {
            try {
            var table = document.getElementById(tableID);
            familiares = table.rows.length;
 			
            for(var i=1; i<familiares; i=i+3) {
                var row = table.rows[i];
                var chkbox = row.cells[3].childNodes[0];
                
                if(null != chkbox && true == chkbox.checked) {
                    if(familiares <= 3) {
                        alert("Cannot delete all the rows.");
                        break;
                    }
                    for(var h=0; h<3; h++){
                    	table.deleteRow(i-1);
                    }
                    
                    familiares= familiares -3;
                    i=i-3;
                    if (familiares == 0) {
						$("#boton_del").hide();
						$("#boton_add").hide();
						tabla=0;
						$("#todo").remove();
						item= "<div id='todo'><div id ='content'></div></div>"
						$("#boton_add").before(item)
					}
                }
 
 
            }
            }catch(e) {
                alert(e);
            }
        };
        
        
    function No() {
		$("#1").hide();
		$("#2").show();
	};
	
	function SI() {
		$("#2").hide();
		$("#1").show();
	};
	

	


</script>

<script src="/static/js/jquery-1.9.1.js" type='text/javascript'></script>           
<script type="text/javascript" src="/static/js/jquery.tablesorter.js"></script>
<link href="/static/css/style.css" rel="stylesheet" type="text/css" media="screen"> 
  
<!-- jQuery -->
	<script src="/static/js/jquery-1.9.1.js" type='text/javascript'></script>  

	<!-- Demo stuff -->
	<link href="/static/css/bootstrap.css" rel="stylesheet">

	<!-- Tablesorter: required for bootstrap -->
	<link rel="stylesheet" href="/static/css/theme.bootstrap.css">
	<script src="/static/js/jquery.tablesorter.js"></script>
	<script src="/static/js/jquery.tablesorter.widgets.js"></script>

	<!-- Tablesorter: optional -->
	<link rel="stylesheet" href="/static/addons/pager/jquery.tablesorter.pager.css">
	<script src="/static/addons/pager/jquery.tablesorter.pager.js"></script>

	<script id="js">$(function() {

	$.extend($.tablesorter.themes.bootstrap, {
		// these classes are added to the table. To see other table classes available,
		// look here: http://twitter.github.com/bootstrap/base-css.html#tables
		table      : 'table table-bordered',
		header     : 'bootstrap-header', // give the header a gradient background
		footerRow  : '',
		footerCells: '',
		icons      : '', // add "icon-white" to make them white; this icon class is added to the <i> in the header
		sortNone   : 'bootstrap-icon-unsorted',
		sortAsc    : 'icon-chevron-up',
		sortDesc   : 'icon-chevron-down',
		active     : '', // applied when column is sorted
		hover      : '', // use custom css here - bootstrap class may not override it
		filterRow  : '', // filter row class
		even       : '', // odd row zebra striping
		odd        : ''  // even row zebra striping
	});

	// call the tablesorter plugin and apply the uitheme widget
	$("table").tablesorter({
		theme : "bootstrap", // this will 

		widthFixed: true,

		headerTemplate : '{content} {icon}', // new in v2.7. Needed to add the bootstrap icon!

		// widget code contained in the jquery.tablesorter.widgets.js file
		// use the zebra stripe widget if you plan on hiding any rows (filter widget)
		widgets : [ "uitheme", "filter", "zebra" ],

		widgetOptions : {
			// using the default zebra striping class name, so it actually isn't included in the theme variable above
			// this is ONLY needed for bootstrap theming if you are using the filter widget, because rows are hidden
			zebra : ["even", "odd"],

			// reset filters button
			filter_reset : ".reset",

			// set the uitheme widget to use the bootstrap theme class names
			// uitheme : "bootstrap"

		}
	})
	.tablesorterPager({

		// target the pager markup - see the HTML block below
		container: $(".pager"),

		// target the pager page select dropdown - choose a page
		cssGoto  : ".pagenum",

		// remove rows from the table to speed up the sort of large tables.
		// setting this to false, only hides the non-visible rows; needed if you plan to add/remove rows with the pager enabled.
		removeRows: false,

		// output string - default is '{page}/{totalPages}';
		// possible variables: {page}, {totalPages}, {filteredPages}, {startRow}, {endRow}, {filteredRows} and {totalRows}
		output: '{startRow} - {endRow} / {filteredRows} ({totalRows})'

	});

});</script>
{% endblock %}
{% block form-title %}<h2>Datos Familiares</h2>{% endblock %}
{% block form %}
				<form id="f5" method="post" class="form-horizontal" action="/socios/create_personal/">
					{% csrf_token %}
					<div class="control-group">
						<label class="control-label">多Familia nueva?</label>
						<div class="controls">
							<label class="radio">
								<input type="radio" name="new_family" id="optionsRadios1" onclick="clickNo()" value="no" checked>
								No
							</label>
							<label class="radio">
								<input type="radio" name="new_family" id="optionsRadios2" onclick="addTable()" value="si">
								Si
							</label>
						</div>
					
							<div id="todo">
								<div id ="content"></div>
							</div>
							<INPUT id="boton_add" type="button" value="A単adir" style="display:none" onclick="addRow('dataTable')" />
							<INPUT id="boton_del" type="button" value="Eliminar" style="display:none" onclick="deleteRow('dataTable')" />		
					</div>
					<div id="family_div">
						
						<table class="tablesorter">
							<thead>
								<tr>
									<th>ID Familia</th>
									<th>Nombre</th>
									<th>Apellidos</th>
									<th>DNI</th>
									<th class="filter-select filter-exact" data-placeholder="Todos">Rol</th>
									<th>Telefono</th>
									<th>Movil</th>
									<th>Email</th>
								</tr>
							</thead>
							<tfoot>
								<tr>
									<th>ID Familia</th>
									<th>Nombre</th>
									<th>Apellidos</th>
									<th>DNI</th>
									<th>Rol</th>
									<th>Telefono</th>
									<th>Movil</th>
									<th>Email</th>
								</tr>
								<tr>
									<th colspan="8" class="pager form-horizontal">
										<button class="btn first"><i class="icon-step-backward"></i></button>
										<button class="btn prev"><i class="icon-arrow-left"></i></button>
										<span class="pagedisplay"></span> <!-- this can be any element, including an input -->
										<button class="btn next"><i class="icon-arrow-right"></i></button>
										<button class="btn last"><i class="icon-step-forward"></i></button>
										<select class="pagesize input-mini" title="Select page size">
											<option selected="selected" value="10">10</option>
											<option value="20">20</option>
											<option value="30">30</option>
											<option value="40">40</option>
										</select>
										<select class="pagenum input-mini" title="Select page number"></select>
									</th>
								</tr>
							</tfoot>
							
							<tbody>
								{% for f in familia %}
									<tr><td>{{f.familia_id.nif}}</td><td>{{f.nombre}}</td><td>{{f.apellidos}}</td><td>{{f.nif}}</td><td>{{f.rol}}</td><td>{{f.telefono}}</td><td>{{f.movil}}</td><td>{{f.email}}</td></tr>
								{% endfor %}
							</tbody>	
						</table>
						
						<div class="control-group">
							<div class="controls">		
								ID Familia: <input type="text" name="nif_family"   placeholder="ID Familia">
							</div>
						</div>
					</div>
					
					
					<div class="control-group">
						<div class="controls">
							<input type="hidden" value="f5" name="form_id" />
						  <button type="submit" class="btn">Siguiente</button>
						</div>
					</div>
											
				</form>
{% endblock %}